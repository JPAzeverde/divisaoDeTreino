<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Sequência de Treino</title>
    <style>

        
    </style>
</head>
<body>

    <h1>Minha Sequência de Treino (12 Dias)</h1>

    <div class="schedule-container">
        <div class="workout-card" data-day="1"><h3>Dia 1</h3><p>PULL A</p></div>
        <div class="workout-card" data-day="2"><h3>Dia 2</h3><p>LEGS A</p></div>
        <div class="workout-card" data-day="3"><h3>Dia 3</h3><p>PUSH</p></div>
        <div class="workout-card off-day"><h3>Dia 4</h3><p>OFF</p></div>
        <div class="workout-card" data-day="5"><h3>Dia 5</h3><p>PULL A</p></div>
        <div class="workout-card" data-day="6"><h3>Dia 6</h3><p>LEGS A</p></div>
        <div class="workout-card" data-day="7"><h3>Dia 7</h3><p>PUSH A</p></div>
        <div class="workout-card off-day"><h3>Dia 8</h3><p>OFF</p></div>
        <div class="workout-card" data-day="9"><h3>Dia 9</h3><p>PULL B</p></div>
        <div class="workout-card" data-day="10"><h3>Dia 10</h3><p>LEGS B</p></div>
        <div class="workout-card" data-day="11"><h3>Dia 11</h3><p>PUSH</p></div>
        <div class="workout-card off-day" data-day="12"><h3>Dia 12</h3><p>OFF</p></div>
    </div>

    <button id="reset-button" class="hidden">Recomeçar Ciclo</button>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- COLE A URL DO SEU APP DA WEB AQUI ---
            const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxXHYsnN29iLFTmjaT-U7gxUEIE0JwE_xMRIOf5IhB0q7Q6uXnAdnodBMTZHdvasDaoyA/exec';
            // -------------------------------------------

            const cards = document.querySelectorAll('.workout-card:not(.off-day)');
            const resetButton = document.getElementById('reset-button');
            const lastCardDay = '11';
            
            // Variável para evitar múltiplos salvamentos ao mesmo tempo
            let isSaving = false;

            // --- 1. FUNÇÃO PARA CARREGAR O ESTADO SALVO (AGORA DA WEB) ---
            async function loadStatus() {
                try {
                    // Chama a URL do App Script (método GET)
                    const response = await fetch(WEB_APP_URL);
                    const data = await response.json();

                    if (data.status === 'success' && data.dias) {
                        // data.dias virá como "1,2,5"
                        const savedDays = data.dias.split(',');
                        
                        savedDays.forEach(day => {
                            const card = document.querySelector(`[data-day="${day}"]`);
                            if (card) {
                                card.classList.add('completed');
                            }
                        });
                    }
                } catch (error) {
                    console.error('Erro ao carregar dados:', error);
                    alert('Não foi possível carregar seus dados. Tente recarregar a página.');
                }
                
                checkResetButtonVisibility();
            }

            // --- 2. FUNÇÃO PARA SALVAR O ESTADO ATUAL (AGORA NA WEB) ---
            async function saveStatus(isReset = false) {
                if (isSaving) return; // Impede salvar se já estiver salvando
                isSaving = true;

                let completedDays = [];
                
                if (!isReset) {
                    cards.forEach(card => {
                        if (card.classList.contains('completed')) {
                            completedDays.push(card.dataset.day);
                        }
                    });
                }
                
                // Converte o array para uma string, ex: "1,2,5"
                const dataToSave = completedDays.join(',');

                try {
                    // Chama a URL (método POST) para enviar os dados
                    const response = await fetch(WEB_APP_URL, {
                        method: 'POST',
                        body: JSON.stringify({ dias: dataToSave }),
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8',
                        },
                    });
                    
                    const result = await response.json();
                    if (result.status !== 'success') {
                        throw new Error(result.message);
                    }
                    console.log('Dados salvos:', result.saved);

                } catch (error) {
                    console.error('Erro ao salvar dados:', error);
                    alert('Não foi possível salvar seu progresso. Verifique sua conexão.');
                }
                
                isSaving = false;
            }

            // --- 3. FUNÇÃO PARA VERIFICAR O BOTÃO DE RESET (igual a antes) ---
            function checkResetButtonVisibility() {
                const lastCard = document.querySelector(`[data-day="${lastCardDay}"]`);
                if (lastCard && lastCard.classList.contains('completed')) {
                    resetButton.classList.remove('hidden');
                } else {
                    resetButton.classList.add('hidden');
                }
            }

            // --- 4. FUNÇÃO PARA CLICAR NO CARD (agora chama saveStatus) ---
            function toggleCard(event) {
                event.currentTarget.classList.toggle('completed');
                saveStatus(); // Salva o novo estado na nuvem
                checkResetButtonVisibility();
            }

            // --- 5. FUNÇÃO PARA RESETAR O CICLO (agora chama saveStatus) ---
            function resetCycle() {
                cards.forEach(card => {
                    card.classList.remove('completed');
                });
                
                // Salva o estado (agora vazio) na nuvem
                saveStatus(true); // 'true' indica que é um reset
                
                checkResetButtonVisibility();
            }

            // --- CONFIGURAÇÃO INICIAL ---
            cards.forEach(card => {
                card.addEventListener('click', toggleCard);
            });
            resetButton.addEventListener('click', resetCycle);

            // Carrega o estado salvo da nuvem
            loadStatus();
        });
    </script>

</body>
</html>